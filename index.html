<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中山韵典在线</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #2c5530;
            --secondary-color: #739e6f;
            --accent-color: #d4b483;
            --light-color: #f8f5f0;
            --dark-color: #1a1a1a;
            --gray-color: #6c757d;
            --white: #fff;
            --shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        body {
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
            font-family: "楷体", "STKaiti", "KaiTi", serif;
        }
        
        /* 宋体应用于非隶书、楷书的汉字元素 - 只针对最初版本不是楷体的元素 */
        .character-title, .search-examples, .example-word,
        .footer-section p, .copyright p, .no-results p, .page-placeholder p {
            font-family: "宋体", "SimSun", "NSimSun", serif;
        }
        
        /* 拼音/英文字母使用无衬线字体，不受影响 */
        .pinyin-text, .entry-pinyin, .search-input, .search-btn,
        .search-mode-select, .search-mode-label, .mode-description,
        .header-info, .logo-text p {
            font-family: Arial, Helvetica, sans-serif;
        }
        
        /* 保留隶书用于logo */
        .logo-text h1 {
            font-family: "隶书", "LiSu", "STLiti", serif;
        }

        /* 特殊汉字图片样式 - 标题大小 */
        .character-img {
            display: inline-block;
            height: 2.5rem; /* 图片高度，和文字一样高 */
            width: auto; /* 自动宽度保持比例 */
            vertical-align: middle; /* 与文字对齐 */
            margin-right: 5px;
        }

        /* 新增：内联图像字样式 - 根据上下文调整大小 */
        .inline-img-char {
            display: inline-block;
            height: 1em; /* 与当前字体高度相同 */
            width: auto; /* 自动宽度保持比例 */
            vertical-align: middle; /* 与文字对齐 */
            margin: 0 1px; /* 微小间距 */
        }
        
        /* 保留楷体用于特定元素 - 包括词条、释义、例句 */
        .nav-menu a, .section-title, body,
        .meaning-item, .entry-title, .entry-definition,
        .example-dialect, .example-translation, .page-content,
        .search-title {
            font-family: "楷体", "STKaiti", "KaiTi", serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* 头部样式 */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--accent-color);
        }
        
        .logo-text h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            font-weight: 700;
            letter-spacing: 2px;
        }
        
        .logo-text p {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .header-info {
            font-family: "Times New Roman", Times, serif;
            font-size: 1rem;
        }
        
        /* 导航菜单 - 始终保持横向排列 */
        nav {
            background-color: var(--secondary-color);
            padding: 0.8rem 0;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .nav-container {
            display: flex;
            justify-content: center;
            min-width: max-content;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 30px;
            padding: 0 10px;
        }
        
        .nav-menu li {
            position: relative;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-size: 1.1rem;
            padding: 8px 15px;
            border-radius: 4px;
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        .nav-menu a:hover, .nav-menu a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        /* 搜索区域 */
        .search-section {
            padding: 3rem 0;
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: white;
            text-align: center;
        }
        
        .search-title {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        
        .search-box {
            max-width: 700px;
            margin: 0 auto;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 18px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }
        
        .search-btn {
            position: absolute;
            right: 8px;
            top: 8px;
            background-color: var(--accent-color);
            color: var(--primary-color);
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            background-color: #e0a95c;
            transform: translateY(-2px);
        }
        
        /* 搜索模式选择 */
        .search-mode-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .search-mode-label {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .search-mode-select {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--primary-color);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-mode-select:hover {
            background-color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .mode-description {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 5px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .search-examples {
            margin-top: 20px;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .example-word {
            display: inline-block;
            margin: 0 8px;
            padding: 5px 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .example-word:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        /* 主要内容区域 */
        .main-content {
            padding: 3rem 0;
        }
        
        /* 搜索结果区域 */
        .results-section {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--secondary-color);
        }
        
        .results-container {
            min-height: 300px;
        }
        
        .character-item {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .character-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .character-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .character-title {
            font-size: 2rem;
            color: var(--primary-color);
            font-weight: 700;
        }
        
        /* 拼音样式 */
        .pinyin-container {
            margin: 15px 0;
        }
        
        .pinyin-item {
            margin-bottom: 20px;
            padding-left: 15px;
            border-left: 3px solid var(--secondary-color);
        }
        
        .pinyin-text {
            font-size: 1.2rem;
            color: var(--secondary-color);
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        /* 释义和词条样式 */
        .meaning-container {
            margin: 10px 0;
        }
        
        .meaning-item {
            margin-bottom: 8px;
            padding: 5px 0;
        }
        
        .entry-container {
            margin: 15px 0;
        }
        
        .entry-item {
            margin: 10px 0;
            padding: 12px;
            background-color: #f5f9f5;
            border-radius: 5px;
            border-left: 4px solid var(--accent-color);
        }
        
        .entry-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .entry-pinyin {
            color: var(--secondary-color);
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .entry-definition {
            color: #444;
            margin-top: 5px;
        }
        
        .example-container {
            margin: 15px 0 0 15px;
            padding: 10px;
            background-color: #f9f7f2;
            border-radius: 5px;
            font-style: italic;
            color: #555;
        }
        
        .example-dialect {
            margin-bottom: 5px;
        }
        
        .example-translation {
            font-size: 0.9rem;
            color: #777;
            border-top: 1px dashed #ddd;
            padding-top: 5px;
        }
        
        /* 注意和语法点样式 */
        .note-container {
            margin: 15px 0;
            padding: 12px;
            background-color: #f0f8ff;
            border-radius: 5px;
            border-left: 4px solid #4a90e2;
        }
        
        .note-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .note-content {
            color: #34495e;
            margin-top: 5px;
        }
        
        /* 儿化音特殊样式 - 匹配儿'整体替换为小字儿，底部持平 */
        .erhua-char {
            display: inline-block;
            font-size: 0.6em; /* 儿化小字尺寸 */
            color: #666;
            margin-left: -0.1em; /* 贴近前一个汉字，减少间距 */
            vertical-align: bottom; /* 核心：与前一字底部持平 */
            line-height: 1; /* 取消行高干扰 */
            transform: scale(0.85); /* 轻微缩小优化视觉 */
            transform-origin: bottom right; /* 变形原点定位准确 */
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-color);
        }
        
        .no-results i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        /* 高亮样式 */
        .highlight {
            background-color: #fffacd;
            padding: 0 2px;
            border-radius: 3px;
            font-weight: bold;
            color: #d35400;
        }
        
        /* 页脚 */
        footer {
            background-color: var(--dark-color);
            color: #bbb;
            padding: 2rem 0 1.5rem;
            margin-top: 2rem;
            text-align: center;
        }
        
        .footer-content {
            margin-bottom: 20px;
        }
        
        .footer-section h4 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-family: "楷体", "STKaiti", "KaiTi", serif;
        }
        
        .footer-section p {
            margin-bottom: 15px;
            font-size: 0.95rem;
            line-height: 1.6;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #444;
            font-size: 0.9rem;
            color: #888;
        }
        
        /* 其他页面样式 */
        .page-content {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .page-placeholder {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-color);
        }
        
        .page-placeholder i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        .page-placeholder h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-family: "楷体", "STKaiti", "KaiTi", serif;
        }

        /* 新增：语法弹窗样式 - 核心自定义UI */
        .grammar-modal-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .grammar-modal-mask.show {
            opacity: 1;
            visibility: visible;
        }
        .grammar-modal-box {
            background: var(--white);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            padding: 2rem;
            box-shadow: var(--shadow);
            text-align: center;
        }
        .grammar-modal-icon {
            font-size: 2.5rem;
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }
        .grammar-modal-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-family: "楷体", "STKaiti", "KaiTi", serif;
        }
        .grammar-modal-desc {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.8;
            margin-bottom: 2rem;
            font-family: "宋体", "SimSun", "NSimSun", serif;
        }
        .grammar-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .modal-btn {
            padding: 10px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "楷体", "STKaiti", "KaiTi", serif;
        }
        .modal-btn-confirm {
            background-color: var(--primary-color);
            color: var(--white);
        }
        .modal-btn-confirm:hover {
            background-color: #234426;
            transform: translateY(-2px);
        }
        .modal-btn-cancel {
            background-color: #eee;
            color: var(--gray-color);
        }
        .modal-btn-cancel:hover {
            background-color: #ddd;
            transform: translateY(-2px);
        }
        
        /* 修复：极简404页面样式 - 全屏、仅保留404大字 */
        .page-404 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #f9f9f9;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9998;
            display: none;
        }
        .page-404.active {
            display: flex;
        }
        .page-404 h1 {
            font-size: 8rem;
            color: var(--primary-color);
            font-family: "宋体", "SimSun", serif;
        }
        
        /* 新增：输入提示弹窗样式 */
        .input-alert-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .input-alert-mask.show {
            opacity: 1;
            visibility: visible;
        }
        .input-alert-box {
            background: var(--white);
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            padding: 2rem;
            box-shadow: var(--shadow);
            text-align: center;
        }
        .input-alert-icon {
            font-size: 2.5rem;
            color: #e74c3c;
            margin-bottom: 1rem;
        }
        .input-alert-title {
            font-size: 1.5rem;
            color: #c0392b;
            margin-bottom: 1rem;
            font-family: "楷体", "STKaiti", "KaiTi", serif;
        }
        .input-alert-desc {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.8;
            margin-bottom: 2rem;
            font-family: "宋体", "SimSun", "NSimSun", serif;
        }
        .input-alert-button {
            padding: 10px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "楷体", "STKaiti", "KaiTi", serif;
            background-color: var(--primary-color);
            color: var(--white);
        }
        .input-alert-button:hover {
            background-color: #234426;
            transform: translateY(-2px);
        }
        
        /* 响应式设计 - 导航栏始终横向排列 + 弹窗适配 + 极简404适配 */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .nav-menu {
                gap: 15px;
            }
            
            .search-title {
                font-size: 1.6rem;
            }
            
            .search-mode-container {
                flex-direction: column;
                gap: 10px;
            }

            .grammar-modal-box {
                padding: 1.5rem;
            }
            .grammar-modal-title {
                font-size: 1.3rem;
            }
            .grammar-modal-desc {
                font-size: 1rem;
            }
            
            .input-alert-box {
                padding: 1.5rem;
            }
            .input-alert-title {
                font-size: 1.3rem;
            }
            .input-alert-desc {
                font-size: 1rem;
            }

            /* 极简404响应式 */
            .page-404 h1 {
                font-size: 5rem;
            }
        }
        
        @media (max-width: 576px) {
            .search-input {
                padding: 15px 20px;
                font-size: 1rem;
            }
            
            .search-btn {
                padding: 10px 20px;
                position: relative;
                right: 0;
                top: 0;
                margin-top: 15px;
                width: 100%;
            }
            
            .search-box {
                display: flex;
                flex-direction: column;
            }
            
            .character-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            /* 导航栏在小屏幕上可水平滚动 */
            nav {
                padding: 0.5rem 0;
            }
            
            .nav-menu {
                gap: 10px;
                padding: 0 5px;
            }
            
            .nav-menu a {
                font-size: 1rem;
                padding: 6px 12px;
            }

            .grammar-modal-buttons {
                flex-direction: column;
            }
            .modal-btn {
                width: 100%;
                padding: 12px 0;
            }

            /* 极简404响应式 */
            .page-404 h1 {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <!-- 头部 -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <div class="logo-text">
                    <h1>中山韵典在线</h1>
                    <p>定州方言查询平台</p>
                </div>
            </div>
            <div class="header-info">
                <p style="font-family: 'Times New Roman', Times, serif;">Dingzhou Dialect Dictionary Online</p>
            </div>
        </div>
    </header>

    <!-- 导航菜单 -->
    <nav>
        <div class="container nav-container">
            <ul class="nav-menu">
                <li><a href="#home" class="active" id="nav-home"><i class="fas fa-home"></i> 首页</a></li>
                <li><a href="#grammar" id="nav-grammar"><i class="fas fa-language"></i> 语法</a></li>
                <li><a href="https://comfy-lebkuchen-174b53.netlify.app/" target="_blank" id="nav-challenge"><i class="fas fa-gamepad"></i> 闯关</a></li>
                <li><a href="#about" id="nav-about"><i class="fas fa-info-circle"></i> 关于</a></li>
            </ul>
        </div>
    </nav>

    <!-- 新增：语法弹窗DOM - 自定义UI -->
    <div class="grammar-modal-mask" id="grammarModal">
        <div class="grammar-modal-box">
            <div class="grammar-modal-icon">
                <i class="fas fa-file-pdf"></i>
            </div>
            <h3 class="grammar-modal-title">定州方言语法扼要</h3>
            <p class="grammar-modal-desc">您将进入《定州方言语法扼要》（半成品）的PDF文件阅览界面，点击"确认"后查看。</p>
            <div class="grammar-modal-buttons">
                <button class="modal-btn modal-btn-confirm" id="modalConfirm">确认</button>
                <button class="modal-btn modal-btn-cancel" id="modalCancel">取消</button>
            </div>
        </div>
    </div>
    
    <!-- 新增：输入提示弹窗DOM -->
    <div class="input-alert-mask" id="inputAlertModal">
        <div class="input-alert-box">
            <div class="input-alert-icon">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <h3 class="input-alert-title">输入无效</h3>
            <p class="input-alert-desc" id="inputAlertMessage">请输入汉字或拼音。</p>
            <button class="input-alert-button" id="inputAlertConfirm">确定</button>
        </div>
    </div>

    <!-- 首页内容 -->
    <div id="home-page" class="page">
        <!-- 搜索区域 -->
        <section class="search-section">
            <div class="container">
                <h2 class="search-title">在《中山韵典》中查询</h2>
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="输入简体汉字或拼音以查询">
                    <button class="search-btn" id="searchBtn">
                        <i class="fas fa-search"></i> 搜索
                    </button>
                </div>
                
                <!-- 搜索模式选择 -->
                <div class="search-mode-container">
                    <div class="search-mode-label">搜索模式：</div>
                    <select class="search-mode-select" id="searchMode">
                        <option value="default">默认模式</option>
                        <option value="reverse">反查模式</option>
                    </select>
                </div>
                
                <div class="mode-description" id="modeDescription">
                    默认模式：仅支持按定州方言查询。反查模式：支持按定州方言查询和通过释义反查。
                </div>
                
                <div class="search-examples">
                    试试搜索：
                    <span class="example-word" data-word="阿">阿</span>
                    <span class="example-word" data-word="包">包</span>
                    <span class="example-word" data-word="爱">爱</span>
                </div>
            </div>
        </section>

        <!-- 搜索结果 -->
        <div class="container main-content">
            <section class="results-section">
                <h2 class="section-title">
                    <i class="fas fa-list-alt"></i> 查询结果
                </h2>
                <div class="results-container" id="resultsContainer">
                    <!-- 初始状态显示提示 -->
                    <div class="no-results" id="initialMessage">
                        <i class="fas fa-search"></i>
                        <h3>欢迎使用中山韵典在线</h3>
                        <p>请输入定州方言字词或拼音进行查询，结果将显示在这里</p>
                        <p style="margin-top: 15px; font-size: 0.9rem; color: #777;">
                            当前为测试数据库，大量内容尚未上传！<br>
                            支持无声调拼音搜索，支持输入ng以匹配到ŋ。<br>
                            暂不支持IPA、繁体字、注音符号等查询。<br>
                            提供“默认模式”和“反查模式”两种搜索方式。
                        </p>
                    </div>
                    
                    <!-- 搜索结果将动态插入到这里 -->
                </div>
            </section>
        </div>
    </div>

    <!-- 语法特点页面（保留DOM，弹窗替代显示） -->
    <div id="grammar-page" class="page" style="display: none;">
        <div class="container main-content">
            <section class="page-content">
                <h2 class="section-title">
                    <i class="fas fa-language"></i> 定州方言语法特点
                </h2>
                <div class="page-placeholder">
                    <i class="fas fa-code-branch"></i>
                    <h2>语法板块正在建设中</h2>
                    <p>语法板块正在建设中</p>
                </div>
            </section>
        </div>
    </div>

    <!-- 关于项目页面 -->
    <div id="about-page" class="page" style="display: none;">
        <div class="container main-content">
            <section class="page-content">
                <h2 class="section-title">
                    <i class="fas fa-info-circle"></i> 关于本站
                </h2>
                <div style="line-height: 1.8;">
                    <h3>《中山韵典》介绍</h3>
                    <p>《中山韵典》是一部收录和解释定州方言的工具书，目前仍在编纂中。</p>
                    
                    <h3 style="margin-top: 25px;">平台介绍</h3>
                    <p>1. 本平台基于《中山韵典》收录定州方言字、词、句。</p>
                    <p>2. 本平台众多内容尚未完善，请等待后续开发。</p>
                    <p>3.目前内容仅是测试内容，方言数据库仍在处理中。</p>
                    <p>4. 本平台暂不支持发音功能。</p>
                    
                    <h3 style="margin-top: 25px;">支持</h3>
                    <p>欢迎提供有关定州方言的词条、例句或语法等内容，共同完善《中山韵典》在线网站。</p>
                </div>
            </section>
        </div>
    </div>

    <!-- 修复：极简404页面DOM - 仅保留404 -->
    <div class="page-404" id="page404">
        <h1>404</h1>
    </div>

    <!-- 页脚 -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>中山韵典在线</h4>
                    <p>定州方言查询平台 © 2026 | 《中山韵典》</p>
                </div>
            </div>
            <div class="copyright">
                <p>联系方式：邮箱2647023658@qq.com</p>
            </div>
        </div>
    </footer>

    <script>
        // ============================================
        // 数据库区域 - 便于直接编辑和导入
        // ============================================
        
        // 新格式数据库 - 使用标记系统 [类型]内容
        const dialectDatabaseText = `
[汉字]阿
[拼音]ā
[词条]阿欠
[词条拼音]ā qìn
[词条释义]〈拟声〉打喷嚏的声音。
[拼音]wō
[词条]阿弥陀佛
[词条拼音]wō mí tuó fó （老派读音）& ē mí tuó fó （新派读音）
[词条释义]佛教指西方极乐世界最大的佛，信佛的人用作口头诵念的佛号，表示祈祷或感谢神灵等意思。
[拼音]ē
[释义]见【阿弥陀佛】。
[拼音]rɑ
[释义]个、只、件等单体量词，用于基数词个位数为1、2、3、4、7、9的数字后构成数量词。

[汉字]傢
[拼音]rá
[释义]“人家”的合音，别人。
[注意]本字含义与【人家】(rén jie)相同，而与【人家儿'】含义不同。

[汉字]拔
[拼音]bá
[释义]抽，拉出。
[拼音]bū
[词条]拔拉
[词条拼音]bū lɑ
[词条释义]拨向自己，或将其拨开，使之远离自己。
[词条]拨浪
[词条拼音]bū lɑnɡ
[词条释义]低垂，垂下，摇动。
[注意]【拨浪鼓儿'】的发音参考本条目。
[词条]拨甩
[词条拼音]bū shɑi
[词条释义]甩。

[汉字]把
[拼音]bǎ
[释义1]拿，抓住。
[释义2]自行车等的手柄。
[释义3]介词，义为拿，处置，致使。
[释义4]量词。
[词条]把脚·把尿
[词条拼音]bǎ jiɑo
[词条释义]把尿，托住孩童双腿使之排泄。
[拼音]bà
[词条]把儿'
[词条拼音]bàr
[词条释义]①脏字、脏话。②男性性器的讳称（平常不用该词）；③某些器物的柄。
[词条例句]说话儿'嫑带把儿'。
[词条例句翻译]不要说脏话。

[汉字]㞎
[拼音]bǎ 
[词条]㞎㞎
[词条拼音]bǎ bɑ
[词条释义]屎，粪便。
[注意]儿童多用。

[汉字]靶
[拼音]bǎ 
[词条]靶子
[词条拼音]bǎ zi
[词条释义]①射击用具；②订书钉；③可以吸附在墙体或其他地方的类似飞镖或橛子的物体；④练习射击的目标物。

[汉字]爸
[拼音]bà
[释义]父亲，新派用词。
[注意]参见【爹】。

[汉字]吧
[拼音]bɑ
[释义]语气词，多用于舒缓语气。


[汉字]啊
[拼音]à
[释义]感痛时的发声。

[汉字]腌
[拼音]ā
[词条]腌臜
[词条拼音]ā zā
[词条释义]脏，不干净。
[拼音]yān
[释义]将某些食物添入或泡入盐、醋等调料品后放置一段时间使之入味。

[汉字]岸
[拼音]ŋàn（老派）& àn（新派）
[释义] 江河湖海等水边的陆地。

[汉字]按
[拼音]ŋàn（老派）& àn（新派）
[释义] 用手或手指压。
[注意]该字不常用，参见【摁】。

[汉字]学
[拼音]xiáo
[释义1]学习。
[例句]我～着哩。
[例句翻译]我正在学习。
[释义2]学校。
[例句]那边儿'有仨么～。
[例句翻译]那边有三座学校。
[词条]学习
[词条拼音]xiáo xí
[词条释义]通过阅读、听讲、研究、实践等获得知识或技能的过程。
[词条]学生
[词条拼音]xiáo shenɡ
[词条释义]在学校学习的人；接受他人的教导并帮助传播和实行的人。
[拼音]xué
[释义]用于文词、新词，如“学校”“数学”。

[汉字]案
[拼音]ŋàn（老派）& àn（新派）
[词条]案子
[词条拼音] ŋàn zi（老派）& àn zi（新派）
[词条释义]①砧板；②案宗，案件。

[汉字]噙
[拼音]qún
[释义]（用嘴）含，完全没入嘴中但不咀嚼或吞咽。

[汉字]含
[拼音]hán
[释义]文词用字，表示包含。

[汉字]哎
[拼音]èi
[释义]应答声。用于应答他人、回应他人，或打招呼引起他人注意。（用此打招呼可能会被视为不礼貌。）
[拼音]ei & yei
[释义]疑问语气代词。

[汉字]挨
[拼音]ŋāi（老派）& āi（新派）
[释义1]靠近，紧挨着。
[例句]咱俩哩座儿'～着哩！
[例句翻译]咱们两个的座位是挨着的！
[释义2]顺着（次序）。
[释义3]受到（不好的事情）。
[词条]挨个儿'
[词条拼音]ŋāi ɡèr（老派）&āi ɡèr（新派）
[词条释义]逐一，依次。
[词条]挨呲儿'
[词条拼音]āi cīr
[词条释义]挨骂、挨训。

[汉字]碍
[拼音]ŋài（老派）& ài（新派）
[释义] 妨碍，阻碍。
[词条]碍妨·碍妨儿'
[词条拼音]ŋài fánɡ(r) · ài fánɡ(r)
[词条释义]妨碍。
[词条]碍事儿'
[词条拼音]ŋài shìr · ài shìr
[词条释义]妨碍做事，造成不方便。
[词条]碍事儿'不拉脚
[词条拼音]ŋài shìr bú lɑ jiǎo · ài shìr bú lɑ jiǎo
[词条释义]碍事儿'。也叫【碍事儿'巴脚】。


[汉字]唉
[拼音]ài
[释义]哀叹声。

[汉字]矮
[拼音]ǎi（新派）& ŋǎi（老派）
[释义1]身材短。
[释义2]（级别、地位）低。
[注意]该字不常用，参见【矬】。

[汉字]爱
[拼音]ài（新派）& ŋài（老派）
[释义]对人或事物有很深的感情。
[例句]我爱你。
[拼音]lài
[词条]爱……不……
[词条拼音]lài……bú……
[词条释义]分别用在同一个动词前面，表示无论选择哪一种都随便，含不满情绪。也写成【赖……不……】。
[词条]爱不不
[词条拼音]lài bú bú
[词条释义]随便你怎么样，含不满情绪。由“爱……不……”句型变体产生，也写成【赖不不】。

[汉字]暗
[拼音]ŋàn（老派）& àn（新派）
[释义] 光线不亮，黑；"明"的反义词。
[注意]该字是文词，口语不常用。

[汉字]熬
[拼音]ŋāo（老派）& āo（新派）
[释义] 烹饪方法，将蔬菜等长时间在水里煮。
[词条]熬菜
[词条拼音]ŋāo cài
[词条释义]用宽粉条、猪肉、白菜等一起熬煮的饭菜，也叫【干粉菜】【大锅菜】。
[拼音]ŋáo（老派）& áo（新派）
[释义] 忍受（艰难痛苦的事情）。
[例句]总算~出来了。

[汉字]赖
[拼音]lài
[释义1]留在某处不肯走开。
[释义2]不承认(过错)。
[释义3]（耍）小聪明。
[释义4]听取某人的意见。
[释义5]同lèi。
[词条]赖你
[词条拼音]lài nǐ
[词条释义]随便；听你的，由你决定。
[词条]赖……不……
[词条拼音]lài……bú……
[词条释义]爱……不……，随你……不……。
[词条例句]~信不信。
[词条例句翻译]信不信由你。
[词条]赖不不
[词条拼音]lài bú bú
[词条释义]随便你怎么样，含不满情绪。由“爱……不……”句型变体产生。
[词条]赖谁谁
[词条拼音]lài shéi shéi
[词条释义]爱谁谁，随便谁。
[拼音]lèi
[释义]次的，不好的，劣质的，差的。

[汉字]袄
[拼音]ŋǎo（老派）& ǎo（新派）
[释义] 棉袄、羽绒服等冬天御寒厚件有里上衣。

[汉字]昂
[拼音]ɑnɡ
[释义1] 肯定答复用语。
[例句]～，这就给你。
[例句翻译]嗯，这就给你。
[释义2]疑问语气代词，用时多与前一字合音或发生增声现象。
[拼音]ànɡ
[释义]强调语气词。

[汉字]安
[拼音]ān（新派）& ŋān（老派）
[释义]安稳。
[词条]安生
[词条拼音]ān shenɡ（新派）& ŋān shenɡ（老派）
[词条释义]安静。
[拼音]ɑn·rɑn·wɑn
[释义]疑问语气代词。
[拼音]ān
[释义]表示自己没有听清、没有理解或希望对方重新组织措辞等，希望让对方再说一次。

[汉字]包
[拼音]bāo
[释义1]用纸、布或其他薄片把东西裹起来。
[释义2]包袱。
[释义3]〈老派〉（石头剪刀布里的）布。
[释义4]赔偿。
[例句]你把我书弄坏了，你得～我。
[例句翻译]你把我的书弄坏了，你要赔我。
[释义5]见【包儿'】。
[词条]包儿'
[词条拼音]bāor
[词条释义]单肩包、挎包、女士包。

[汉字]俺
[拼音]ŋǎn（老派）& ǎn（新派）
[释义1] 我的。
[例句] ~书不见了。
[例句翻译] 我的书不见了。
[释义2] 我们。
[例句] 俺俩不跟你玩儿了。
[例句翻译] 我们两个不和你玩儿了。
[释义3] 我们的。
[例句] 这俺哩，不教你使。
[例句翻译] 这个是我们的，不让你用。
[释义4] 我家，我家的。
[例句] 教你欺负俺，遭报应哩吧。
[例句翻译] 让你欺负我家小孩儿'，遭报应了吧。

[汉字]八
[拼音]bā
[释义1]七的下一个数字，九的上一个数字。
[释义2]虚指，形容数次之多。
[词条]八成儿'
[词条拼音]bā chénɡr
[词条释义]多半、大概。常用于可能性的猜测。
[词条]八哇
[词条拼音]bā wɑ
[词条释义]八个，八只，八件等，即以八为数词的不以双、群等非单体量词的数量词。

[汉字]巴
[拼音]bā
[词条]巴儿'巴儿'
[词条拼音]bār bār
[词条释义]①明明。②无意义地。
[词条例句]我～写作业哩，你干嘛非说我没写焉？
[词条例句翻译]我明明在写作业，你为什么非说我没写呢？
[词条例句]你们玩去，就教我～等着你们咉?
[词条例句翻译]你们去玩，就让我干等着你们吗?
[词条]巴不哩
[词条拼音] bā bú li
[词条释义]巴不得，急切地盼望。
[词条]巴条虎儿'
[词条拼音]bā tiáo hǔr
[词条释义]壁虎。
[词条]巴凉儿'
[词条拼音]bā liánɡr
[词条释义]很凉，极凉。
[词条]巴掌
[词条拼音]bā zhɑnɡ
[词条释义]手，手掌。
[词条]巴掌儿'
[词条拼音]bā zhɑnɡr
[词条释义]手套（“手巴掌儿'”的省称）。
[拼音]bɑ
[释义]部分词的成词后缀，多儿化，如【磕巴儿'】【张巴儿'】。

[汉字]叭
[拼音]bā
[词条]叭儿'叭儿'
[词条拼音]bār bɑr
[词条释义]〈贬〉不停地说话。也说【嘚（不）嘚】。

[汉字]疤
[拼音]bā
[释义]伤口愈合后的痕迹。
[词条]疤瘌
[词条拼音]bā lɑ
[词条释义]疤。

[汉字]额
[拼音]ŋé（老派）& é（新派）
[释义]文读音，用于例如“额头”“余额”“名额儿'”等词汇中。
[拼音]yé
[词条]额颅盖儿'
[词条拼音]yé lɑ ɡàir
[词条释义]额头。

[汉字]掰
[拼音]bāi
[释义]用手把东西折断。

[汉字]白
[拼音]bái
[释义1]和黑相对的颜色。
[释义2]徒然地，无果地。
[释义3]和丧事有关的。
[释义4]用白眼珠看人。表示轻视、不满。
[释义5]姓氏。
[释义6]〈老〉动词后缀，无实义。用于单音节动词后补充音节或者贬低该动词行为。
[词条]白日
[词条拼音]bái ri
[词条释义]昼，白天，天亮到天黑之间的时间。
[词条]白山药
[词条拼音]bái shái you ·bái shái yɑo
[词条释义]薯蓣，即普通话所说的“山药”。
[词条]白色儿'
[词条拼音]bái sháir
[词条释义]白色，雪的颜色。
[词条]白事儿'
[词条拼音]bái shìr
[词条释义]丧事，为刚过世的人举办的包含殓葬、悼念等的活动。

[汉字]拜
[拼音]bài
[释义]表示行礼。
[拼音]bái
[词条]拜拜
[词条拼音]bái bɑi
[词条释义]再见。新派用词，源自英语。

[汉字]百
[拼音]bǎi
[释义1]十乘以十的得数。
[释义2]极言数量之多。
[词条]百当儿'
[词条拼音]bǎi dɑnɡr
[词条解释]最后，终究。
[百嘛儿'不是]bǎi màr bú shì
[词条释义]什么都不是。也写作【百么儿'不是】，也说【百屁不是】。
[注意]在定州方言里，ɑ和e儿化以后的读音是一样的。
[词条]百不怎么着
[词条拼音]bǎi bú zěnɡ zhɑo
[词条解释]谓无法应对情况，听天由命。相当于回应“怎么办？”的“凉拌！”。

[汉字]伯
[拼音]bǎi
[词条]伯伯
[词条拼音]bǎi bɑi
[词条释义]伯父，父亲的哥哥。

[汉字]摆
[拼音]bǎi
[释义1]安放，排列。
[释义2]摇动，摇摆。
[释义3]〈动〉饥，饿。使……饥饿。用法参考【注意】。
[词条]摆哩慌
[词条拼音]bǎi li huɑnɡ
[词条释义]饿得慌
[词条例句]我可～哩。
[词条例句翻译]我很饿。
[词条拼音]bái sǐ
[词条释义]饿死。
[注意]该字只可作为动词使用，且不可直接接宾语。如果需要形容词词性，需要改形式为“～哩慌”。如：*我～了。*你～㗑？都是错误用法。正确用法是：我摆哩慌了。（我饿了）你摆哩慌㗑？（你饿了吗？）

[汉字]㗑
[拼音]bên·bê·bɑi
[释义]疑问语气代词，用于一般的对客观情况询问的是否疑问。

[汉字]败
[拼音]bài
[释义]输，失败。
[释义]祛除，消散。
[词条]败火
[词条拼音]bài huǒ
[释义]祛火。

[汉字]柏
[拼音]bǎi
[释义]柏树。

[汉字]佰
[拼音]bǎi
[释义]百。“百”的大写数字。

[汉字]扳
[拼音]bān
[释义1]使位置固定的东西改变方向或转动。
[释义2]把输掉的赢回。
[词条]扳手儿'
[词条拼音]bān shǒur
[词条释义]拧紧或松开螺丝、螺母的器具。

[汉字]IMG:char1
[拼音]jiě
[释义]“给你”的合音，即给你。
[注意]该字只能单字成句，不可组词或用于句子成分。目前该字已经罕见使用。

[汉字]班
[拼音]bān
[释义]见【班儿'】。
[词条]班儿'
[词条释义]①班级；②工作勤业的时间；③班次，定时定点固定路线的趟次，见【班儿'车】；④职业工作类型。
[词条]班儿'车
[词条拼音]bānr chē
[词条释义]有大致固定路线的、按照大致固定时间发车的、有大致固定趟次的承载多人的无轨车辆，例如公交车。
[词条]班长
[词条拼音]bān zhǎnɡ
[词条释义]班级中由学生担任的主要干部，班级中学生的主要领导。

[汉字]般
[拼音]bān
[释义]见【般般】。
[词条]般般
[词条拼音]bān bɑn
[词条释义]见【般儿'般儿'】。
[词条]般儿'般儿'
[词条拼音]bānr bɑnr
[词条释义]见【边儿'边儿'】。

[汉字]边
[拼音]biàn
[释义]见【边儿'】。
[释义]姓。
[词条]边儿'
[词条拼音]biānr
[词条释义]①边缘，靠近物体的地方；②方位词后缀。③（一）侧，（一）阵营。
[拼音]bān
[词条]边儿'
[词条拼音]bānr
[词条释义]①（一）侧，（一）阵营。也写作【班儿'】；②方位词后缀”。
[词条]边边
[词条拼音]bān bɑn
[词条释义]见【边儿'边儿'】和本字页面底部的“注意”。也写作【般般】。
[词条]边儿'边儿'
[词条拼音]bānr bɑnr
[词条释义]两者的某度量衡相同或大致相同，例如一样高、长。该词后一般只接更强势的度量衡单位，如用高而不用矮，用长而不用短。另见本字页面底部的“注意”。也写作【般儿'般儿'】。
[词条例句]我跟他～高。
[词条例句翻译]我和他一样高。
[注意]使用【边儿'边儿'】则后接的字词不儿化，使用【边边】则后接的字词大多情况下儿化，但也有不儿化的可能。如【边儿'边儿'大】等同于【边边大儿'】。

[汉字]斑
[拼音]bān
[释义]斑点，斑纹。在具有某种颜色的物体表面上夹有的另外颜色的点、条纹。

[汉字]搬
[拼音]bān
[释义]迁移，移动物体的位置（多指笨重的或较大的）。
[词条]搬腾。
[词条释义]①即“搬”；②来回不停地搬动；③在餐余时间或不正当的用餐时间进行用餐、食用。

[汉字]板
[拼音]bǎn
[释义]见【板儿'】。
[释义]露出严肃或不高兴的表情。
[词条]板儿'
[词条拼音]bǎnr
[词条释义]片状的较硬的物体；板状的物体。也叫【板子】。
[词条]板床儿'
[词条拼音]bǎn chuánɡr
[词条释义]较矮的坐具，多指马扎儿'或小板凳儿'。
[词条]板儿'床
[词条拼音]bǎnr chuánɡ
[词条释义]木板制成的床铺，多用于宿舍单人床。

[汉字]版
[拼音]bǎn
[释义]板底，版面，版次。
[词条]版本儿'
[词条拼音]bán bénr
[词条释义]同一作品的不同表现形式或因修改产生的不同具体样式。
[注意]【正版】不儿化而【盗版儿'】儿化。

`;

        // ============================================
        // 数据库解析函数 - 将文本格式转换为结构化数据
        // ============================================
        function parseDialectDatabase(text) {
            const entries = [];
            const lines = text.trim().split('\n');
            
            let currentEntry = null;
            let currentPinyin = null;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('[汉字]')) {
                    // 开始新字条
                    if (currentEntry) {
                        if (currentPinyin) {
                            currentEntry.pinyins.push(currentPinyin);
                        }
                        entries.push(currentEntry);
                    }
                    
                    let charValue = line.substring(4);
                    // 判断是否是图片标记
                    let character;
                    if (charValue.startsWith('IMG:')) {
                        // 图片类型，存储图片信息
                        character = {
                            type: 'img',
                            src: charValue.substring(4) // 去掉'IMG:'，得到char1
                        };
                    } else {
                        // 普通文本类型
                        character = charValue;
                    }
                    
                    currentEntry = {
                        character: character,
                        pinyins: []
                    };
                    currentPinyin = null;
                }
                else if (line.startsWith('[拼音]')) {
                    // 新拼音
                    if (currentPinyin) {
                        currentEntry.pinyins.push(currentPinyin);
                    }
                    
                    currentPinyin = {
                        pinyin: line.substring(4),
                        meanings: [],
                        examples: [],
                        entries: [],
                        notes: null
                    };
                }
                else if (line.startsWith('[释义')) {
                    // 释义（支持[释义1]、[释义2]等格式）
                    if (currentPinyin) {
                        currentPinyin.meanings.push(line.substring(line.indexOf(']') + 1));
                    }
                }
                else if (line.startsWith('[例句]')) {
                    // 例句
                    if (currentPinyin) {
                        // 检查下一行是否是例句翻译
                        let translation = '';
                        if (i + 1 < lines.length && lines[i + 1].trim().startsWith('[例句翻译]')) {
                            translation = lines[i + 1].trim().substring(6);
                            i++; // 跳过翻译行
                        }
                        
                        currentPinyin.examples.push({
                            dialect: line.substring(4),
                            translation: translation
                        });
                    }
                }
                else if (line.startsWith('[词条]')) {
                    // 词条
                    if (currentPinyin) {
                        const entry = {
                            title: line.substring(4),
                            examples: [] // 添加词条例句数组
                        };
                        
                        // 继续解析词条相关行
                        for (let j = i + 1; j < lines.length; j++) {
                            const nextLine = lines[j].trim();
                            
                            if (nextLine.startsWith('[词条拼音]')) {
                                entry.entryPinyin = nextLine.substring(6);
                            }
                            else if (nextLine.startsWith('[词条释义]')) {
                                entry.definition = nextLine.substring(6);
                            }
                            else if (nextLine.startsWith('[词条例句]')) {
                                // 词条例句
                                const entryExample = {
                                    dialect: nextLine.substring(6)
                                };
                                
                                // 检查是否有词条例句翻译
                                if (j + 1 < lines.length && lines[j + 1].trim().startsWith('[词条例句翻译]')) {
                                    entryExample.translation = lines[j + 1].trim().substring(8);
                                    j++; // 跳过翻译行
                                }
                                
                                entry.examples.push(entryExample);
                            }
                            else if (nextLine.startsWith('[词条]') || nextLine.startsWith('[拼音]') || 
                                     nextLine.startsWith('[例句]') || nextLine.startsWith('[释义') || 
                                     nextLine.startsWith('[注意]') || nextLine.startsWith('[汉字]')) {
                                // 遇到下一个标记，回退并跳出循环
                                i = j - 1;
                                break;
                            }
                            else if (nextLine === '' || j === lines.length - 1) {
                                // 空行或文件结束
                                i = j;
                                break;
                            }
                            else {
                                // 继续解析，直到遇到下一个标记或空行
                                i = j;
                            }
                        }
                        
                        currentPinyin.entries.push(entry);
                    }
                }
                else if (line.startsWith('[注意]')) {
                    // 注意事项
                    if (currentPinyin) {
                        currentPinyin.notes = line.substring(4);
                    }
                }
            }
            
            // 添加最后一个条目
            if (currentEntry) {
                if (currentPinyin) {
                    currentEntry.pinyins.push(currentPinyin);
                }
                entries.push(currentEntry);
            }
            
            return entries;
        }
        
        // 解析数据库
        const dialectDatabase = parseDialectDatabase(dialectDatabaseText);

        // ============================================
        // 工具函数和DOM元素
        // ============================================
        
        // DOM元素
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const resultsContainer = document.getElementById('resultsContainer');
        const initialMessage = document.getElementById('initialMessage');
        const exampleWords = document.querySelectorAll('.example-word');
        const searchModeSelect = document.getElementById('searchMode');
        const modeDescription = document.getElementById('modeDescription');
        // 新增：弹窗相关DOM
        const grammarModal = document.getElementById('grammarModal');
        const modalConfirm = document.getElementById('modalConfirm');
        const modalCancel = document.getElementById('modalCancel');
        const grammarLink = document.getElementById('nav-grammar');
        // 新增：404相关DOM
        const page404 = document.getElementById('page404');
        // 新增：输入提示弹窗DOM
        const inputAlertModal = document.getElementById('inputAlertModal');
        const inputAlertMessage = document.getElementById('inputAlertMessage');
        const inputAlertConfirm = document.getElementById('inputAlertConfirm');
        
        // 页面元素
        const pages = {
            home: document.getElementById('home-page'),
            grammar: document.getElementById('grammar-page'),
            about: document.getElementById('about-page'),
            404: document.getElementById('page404') // 新增404页面
        };
        
        // 导航元素
        const navLinks = {
            home: document.getElementById('nav-home'),
            grammar: document.getElementById('nav-grammar'),
            about: document.getElementById('nav-about')
        };
        
        // 当前搜索词，用于高亮
        let currentSearchQuery = '';
        
        // 当前搜索模式
        let currentSearchMode = 'default';
        
        // PDF跳转链接
        const PDF_LINK = 'https://www.kdocs.cn/l/cmRDmIOgvWIH?f=201';
        
        // 修复：检查输入是否包含非法字符 - 现在允许带声调的字母
        function containsInvalidChars(str) {
            if (!str) return false;
            
            // 允许的字符：汉字、拉丁字母（包括带声调的）、空格
            // 包括：ɑāáǎàēéěèêūúǔùōóǒòīíǐìǖǘǚǜüŋ以及普通a-zA-Z
            const validPattern = /^[\u4e00-\u9fa5a-zA-Z\sɑāáǎàēéěèêūúǔùəōóǒòīíǐìǖǘǚǜüŋ]*$/;
            return !validPattern.test(str);
        }
        
        // 处理ng与ŋ的互相转换 - 修复：只将ŋ转换为ng，但不将ng转换回ŋ
        function normalizeNgToEng(str) {
            if (!str) return '';
            // 将ŋ转换为ng，同时处理大小写
            return str.replace(/ŋ/g, 'ng').replace(/Ŋ/g, 'NG');
        }
        
        // 修复：正确的儿化音处理函数 - 先处理儿化音
        function processErhua(text) {
            if (!text) return text;
            // 使用正则表达式全局匹配"儿'"，替换为小字儿
            return text.replace(/儿'/g, '<span class="erhua-char">儿</span>');
        }
        
        // 新增：图像字处理函数 - 在任何文本中替换IMG:标记为图像
        function replaceImageMarkers(text, isTitle = false) {
            if (!text) return text;
            
            // 使用正则表达式匹配IMG:charX模式
            const imgPattern = /IMG:(\w+)/g;
            
            // 替换为对应的图像标签
            return text.replace(imgPattern, (match, imgName) => {
                // 如果是标题，使用较大的图片样式，否则使用内联样式
                const imgClass = isTitle ? 'character-img' : 'inline-img-char';
                return `<img src="images/${imgName}.png" alt="生僻字" class="${imgClass}">`;
            });
        }
        
        // 修复：组合处理函数 - 先处理图像，再处理儿化音
        function processTextWithImages(text, isTitle = false) {
            if (!text) return text;
            // 先替换图像标记，再处理儿化音
            const withImages = replaceImageMarkers(text, isTitle);
            return processErhua(withImages);
        }
        
        // 移除音调符号
        function removeTones(pinyin) {
            if (!pinyin) return '';
            // 移除所有音调符号，但保留ŋ
            return pinyin
                .replace(/[āáǎàɑ]/g, 'a')
                .replace(/[ēéěèê]/g, 'e')
                .replace(/[īíǐì]/g, 'i')
                .replace(/[ōóǒò]/g, 'o')
                .replace(/[ūúǔù]/g, 'u')
                .replace(/[ǖǘǚǜü]/g, 'v')
                .replace(/[g]/g, 'ɡ');
        }
        
        // 修复：获取纯文本（去除HTML标签，并处理儿化音为普通"儿"，同时去除图像标记）
        function getPlainText(text) {
            if (!text) return '';
            // 先将"儿'"替换为"儿"，将图像标记转换为占位符
            let textWithoutMarkers = text.replace(/儿'/g, '儿');
            textWithoutMarkers = textWithoutMarkers.replace(/IMG:\w+/g, '[字]');
            // 移除所有HTML标签
            return textWithoutMarkers.replace(/<[^>]*>/g, '');
        }
        
        // 修复：高亮函数 - 先处理图像和儿化音，再进行高亮
        function highlightText(text, query, isTitle = false) {
            if (!text) return '';
            
            // 如果没有查询词，只处理图像和儿化音
            if (!query || query.trim() === '') {
                return processTextWithImages(text, isTitle);
            }
            
            // 先处理图像标记和儿化音
            const processedText = processTextWithImages(text, isTitle);
            
            // 对查询词进行转义，用于正则表达式
            const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            
            try {
                // 区分大小写匹配
                const regex = new RegExp(`(${escapedQuery})`, 'g');
                
                // 在高亮前，我们需要处理一个特殊情况：如果文本已经包含HTML（如图像标签），
                // 我们不能直接替换整个文本，否则会破坏HTML结构
                
                // 创建一个临时容器来保存处理后的文本
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = processedText;
                
                // 递归遍历所有文本节点进行高亮
                function highlightTextNodes(node, pattern) {
                    if (node.nodeType === Node.TEXT_NODE) {
                        const text = node.textContent;
                        if (pattern.test(text)) {
                            const span = document.createElement('span');
                            span.innerHTML = text.replace(pattern, '<span class="highlight">$1</span>');
                            node.parentNode.replaceChild(span, node);
                        }
                    } else if (node.nodeType === Node.ELEMENT_NODE && 
                               node.nodeName !== 'IMG' && 
                               node.nodeName !== 'SPAN' && 
                               !node.classList.contains('highlight') &&
                               !node.classList.contains('erhua-char')) {
                        // 递归处理子节点，但跳过已经高亮的元素、图像和儿化音
                        for (let i = 0; i < node.childNodes.length; i++) {
                            highlightTextNodes(node.childNodes[i], pattern);
                        }
                    }
                }
                
                // 应用高亮
                const highlightRegex = new RegExp(`(${escapedQuery})`, 'g');
                highlightTextNodes(tempDiv, highlightRegex);
                
                return tempDiv.innerHTML;
            } catch (e) {
                console.error('正则表达式构建失败:', e);
                return processedText;
            }
        }
        
        // 显示输入提示弹窗
        function showInputAlert(message) {
            inputAlertMessage.textContent = message;
            inputAlertModal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }
        
        // 隐藏输入提示弹窗
        function hideInputAlert() {
            inputAlertModal.classList.remove('show');
            document.body.style.overflow = 'auto';
        }
        
        // 显示初始消息
        function showInitialMessage() {
            resultsContainer.innerHTML = `
                <div class="no-results" id="initialMessage">
                    <i class="fas fa-search"></i>
                    <h3>欢迎使用中山韵典在线</h3>
                    <p>请输入定州方言字词或拼音进行查询，结果将显示在这里</p>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: #777;">
                         当前为测试数据库，大量内容尚未上传！<br>
                            支持无声调拼音搜索， 输入ng可以匹配到ŋ。<br>
                            暂不支持IPA、繁体字、注音符号等查询。<br>
                            提供“默认模式”和“反查模式”两种搜索方式。
                    </p>
                </div>
            `;
        }
        
        // 修复：默认模式匹配函数 - 正确处理ŋ匹配、图像标记和儿化音
        function matchesSearchDefault(item, query) {
            if (!query) return false;
            
            const queryLower = query.toLowerCase();
            
            // 1. 检查汉字匹配（兼容对象和字符串类型）
            if (typeof item.character === 'string') {
                // 如果是普通字符串汉字，先将"儿'"替换为"儿"，图像标记转换为占位符再进行匹配
                let charToMatch = item.character.replace(/儿'/g, '儿');
                charToMatch = charToMatch.replace(/IMG:\w+/g, '[字]');
                if (charToMatch.includes(query)) {
                    return true;
                }
            } else if (item.character.type === 'img') {
                // 如果是图像字，检查查询是否为图像名称
                if (query === 'IMG:' + item.character.src || query === item.character.src) {
                    return true;
                }
            }
            
            // 2. 检查拼音匹配
            for (const pinyinObj of item.pinyins) {
                const pinyin = pinyinObj.pinyin;
                const pinyinLower = pinyin.toLowerCase();
                
                // 修复：单个n或g不应该匹配到ŋ
                // 只有当查询是"ng"时才匹配到包含ŋ的拼音
                if (queryLower === 'ng') {
                    // 检查是否包含ŋ
                    if (pinyinLower.includes('ŋ')) {
                        return true;
                    }
                    // 检查转换后的拼音是否包含ng
                    const normalizedPinyin = normalizeNgToEng(pinyinLower);
                    if (normalizedPinyin.includes('ng')) {
                        return true;
                    }
                }
                
                // 检查原始拼音（区分大小写）
                if (pinyin.includes(query)) {
                    return true;
                }
                
                // 检查无声调拼音匹配
                const pinyinNoTone = removeTones(pinyinLower);
                const queryNoTone = removeTones(queryLower);
                
                if (pinyinNoTone.includes(queryNoTone)) {
                    return true;
                }
                
                // 检查词条匹配
                if (pinyinObj.entries) {
                    for (const entry of pinyinObj.entries) {
                        // 检查词条标题，将"儿'"替换为"儿"，图像标记转换为占位符再进行匹配
                        if (entry.title) {
                            let entryTitle = entry.title.replace(/儿'/g, '儿');
                            entryTitle = entryTitle.replace(/IMG:\w+/g, '[字]');
                            if (entryTitle.includes(query)) {
                                return true;
                            }
                        }
                        
                        // 检查词条拼音
                        if (entry.entryPinyin) {
                            const entryPinyin = entry.entryPinyin;
                            const entryPinyinLower = entryPinyin.toLowerCase();
                            
                            // 修复：单个n或g不应该匹配到ŋ
                            if (queryLower === 'ng') {
                                if (entryPinyinLower.includes('ŋ')) {
                                    return true;
                                }
                                const normalizedEntryPinyin = normalizeNgToEng(entryPinyinLower);
                                if (normalizedEntryPinyin.includes('ng')) {
                                    return true;
                                }
                            }
                            
                            if (entryPinyin.includes(query)) {
                                return true;
                            }
                            
                            // 检查词条拼音的无声调匹配
                            const entryPinyinNoTone = removeTones(entryPinyinLower);
                            if (entryPinyinNoTone.includes(queryNoTone)) {
                                return true;
                            }
                        }
                    }
                }
            }
            
            return false;
        }
        
        // 修复：反查模式匹配函数 - 正确处理儿化音和图像标记
        function matchesSearchReverse(item, query) {
            if (!query) return false;
            
            const queryLower = query.toLowerCase();
            
            // 1. 检查汉字匹配（兼容对象和字符串类型）
            if (typeof item.character === 'string') {
                // 如果是普通字符串汉字，先将"儿'"替换为"儿"，图像标记转换为占位符再进行匹配
                let charToMatch = item.character.replace(/儿'/g, '儿');
                charToMatch = charToMatch.replace(/IMG:\w+/g, '[字]');
                if (charToMatch.includes(query)) {
                    return true;
                }
            } else if (item.character.type === 'img') {
                // 如果是图像字，检查查询是否为图像名称
                if (query === 'IMG:' + item.character.src || query === item.character.src) {
                    return true;
                }
            }
            
            // 2. 检查拼音匹配
            for (const pinyinObj of item.pinyins) {
                const pinyin = pinyinObj.pinyin;
                const pinyinLower = pinyin.toLowerCase();
                
                // 修复：单个n或g不应该匹配到ŋ
                if (queryLower === 'ng') {
                    if (pinyinLower.includes('ŋ')) {
                        return true;
                    }
                    const normalizedPinyin = normalizeNgToEng(pinyinLower);
                    if (normalizedPinyin.includes('ng')) {
                        return true;
                    }
                }
                
                // 检查原始拼音（区分大小写）
                if (pinyin.includes(query)) {
                    return true;
                }
                
                // 检查无声调拼音匹配
                const pinyinNoTone = removeTones(pinyinLower);
                const queryNoTone = removeTones(queryLower);
                
                if (pinyinNoTone.includes(queryNoTone)) {
                    return true;
                }
                
                // 3. 检查释义匹配 - 使用纯文本，避免HTML标签匹配，并处理儿化音和图像标记
                if (pinyinObj.meanings) {
                    for (const meaning of pinyinObj.meanings) {
                        const plainMeaning = getPlainText(meaning);
                        if (plainMeaning.includes(query)) {
                            return true;
                        }
                        // 检查无声调拼音匹配
                        if (removeTones(plainMeaning.toLowerCase()).includes(queryNoTone)) {
                            return true;
                        }
                    }
                }
                
                // 4. 检查词条匹配
                if (pinyinObj.entries) {
                    for (const entry of pinyinObj.entries) {
                        // 检查词条标题，处理儿化音和图像标记
                        if (entry.title) {
                            let entryTitle = entry.title.replace(/儿'/g, '儿');
                            entryTitle = entryTitle.replace(/IMG:\w+/g, '[字]');
                            if (entryTitle.includes(query)) {
                                return true;
                            }
                        }
                        
                        // 检查词条拼音
                        if (entry.entryPinyin) {
                            const entryPinyin = entry.entryPinyin;
                            const entryPinyinLower = entryPinyin.toLowerCase();
                            
                            // 修复：单个n或g不应该匹配到ŋ
                            if (queryLower === 'ng') {
                                if (entryPinyinLower.includes('ŋ')) {
                                    return true;
                                }
                                const normalizedEntryPinyin = normalizeNgToEng(entryPinyinLower);
                                if (normalizedEntryPinyin.includes('ng')) {
                                    return true;
                                }
                            }
                            
                            if (entryPinyin.includes(query)) {
                                return true;
                            }
                            
                            // 检查词条拼音的无声调匹配
                            const entryPinyinNoTone = removeTones(entryPinyinLower);
                            if (entryPinyinNoTone.includes(queryNoTone)) {
                                return true;
                            }
                        }
                        
                        // 检查词条释义 - 使用纯文本，并处理儿化音和图像标记
                        if (entry.definition) {
                            const plainDefinition = getPlainText(entry.definition);
                            if (plainDefinition.includes(query)) {
                                return true;
                            }
                            // 检查无声调拼音匹配
                            if (removeTones(plainDefinition.toLowerCase()).includes(queryNoTone)) {
                                return true;
                            }
                        }
                        
                        // 检查词条例句 - 使用纯文本，并处理儿化音和图像标记
                        if (entry.examples) {
                            for (const example of entry.examples) {
                                if (example.dialect) {
                                    const plainDialect = getPlainText(example.dialect);
                                    if (plainDialect.includes(query)) {
                                        return true;
                                    }
                                    // 检查无声调拼音匹配
                                    if (removeTones(plainDialect.toLowerCase()).includes(queryNoTone)) {
                                        return true;
                                    }
                                }
                                if (example.translation) {
                                    const plainTranslation = getPlainText(example.translation);
                                    if (plainTranslation.includes(query)) {
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                }
                
                // 5. 检查例句匹配 - 使用纯文本，并处理儿化音和图像标记
                if (pinyinObj.examples) {
                    for (const example of pinyinObj.examples) {
                        if (example.dialect) {
                            const plainDialect = getPlainText(example.dialect);
                            if (plainDialect.includes(query)) {
                                return true;
                            }
                            // 检查无声调拼音匹配
                            if (removeTones(plainDialect.toLowerCase()).includes(queryNoTone)) {
                                return true;
                            }
                        }
                        if (example.translation) {
                            const plainTranslation = getPlainText(example.translation);
                            if (plainTranslation.includes(query)) {
                                return true;
                            }
                        }
                    }
                }
                
                // 6. 检查注意事项匹配 - 使用纯文本，并处理儿化音和图像标记
                if (pinyinObj.notes) {
                    const plainNotes = getPlainText(pinyinObj.notes);
                    if (plainNotes.includes(query)) {
                        return true;
                    }
                    // 检查无声调拼音匹配
                    if (removeTones(plainNotes.toLowerCase()).includes(queryNoTone)) {
                        return true;
                    }
                }
            }
            
            return false;
        }

        // 修复：极简404切换函数 - 直接显示404页面，隐藏其他所有内容
        function switchTo404() {
            // 隐藏所有页面和网站元素
            document.querySelector('header').style.display = 'none';
            document.querySelector('nav').style.display = 'none';
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('grammar-page').style.display = 'none';
            document.getElementById('about-page').style.display = 'none';
            document.querySelector('footer').style.display = 'none';
            
            // 隐藏语法弹窗（如果打开）
            document.getElementById('grammarModal').classList.remove('show');
            
            // 隐藏输入提示弹窗（如果打开）
            document.getElementById('inputAlertModal').classList.remove('show');
            
            // 显示404页面
            document.getElementById('page404').style.display = 'flex';
            
            // 重置导航激活状态
            Object.keys(navLinks).forEach(key => {
                if (navLinks[key]) navLinks[key].classList.remove('active');
            });
            
            // 禁止页面滚动
            document.body.style.overflow = 'hidden';
        }
        
        // 搜索函数 - 新增腚字检测和输入验证
        function searchDialect(query, mode) {
            // 如果查询为空，显示初始消息
            if (!query.trim()) {
                showInitialMessage();
                return;
            }
            
            // 检查特殊关键词"every"（不区分大小写）
            if (query.toLowerCase() === 'every') {
                // 显示全部内容
                displayAllEntries();
                return;
            }
            
            // 核心检测：搜索词包含"腚"则直接跳404
            if (query.includes('腚')) {
                switchTo404();
                return;
            }
            
            // 检查输入是否包含非法字符
            if (containsInvalidChars(query)) {
                showInputAlert('请输入汉字或拼音，不支持其他字符。');
                return;
            }
            
            // 保存当前搜索词用于高亮
            currentSearchQuery = query;
            
            // 清空结果容器
            resultsContainer.innerHTML = '';
            
            // 根据搜索模式选择匹配函数
            let results;
            if (mode === 'reverse') {
                results = dialectDatabase.filter(item => matchesSearchReverse(item, query));
            } else {
                results = dialectDatabase.filter(item => matchesSearchDefault(item, query));
            }
            
            // 显示结果
            if (results.length > 0) {
                displayResults(results, query);
            } else {
                // 没有找到结果
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-question-circle"></i>
                        <h3>搜索不到结果</h3>
                        <p>未找到与“${query}”相关的定州方言词条</p>
                        <p>该词条可能尚未收录，不代表一定不存于定州方言。</p>
                        <p>当前仅支持使用简体汉字或拼音查询。</p>
                    </div>
                `;
            }
        }
        
        // 显示所有条目
        function displayAllEntries() {
            currentSearchQuery = '';
            resultsContainer.innerHTML = '';
            
            // 显示所有数据库条目
            dialectDatabase.forEach(item => {
                const resultElement = document.createElement('div');
                resultElement.className = 'character-item';
                
                // 创建汉字标题
                let characterDisplay;
                if (typeof item.character === 'object' && item.character.type === 'img') {
                    // 如果是图片类型的汉字
                    characterDisplay = `<img src="images/${item.character.src}.png" alt="生僻字" class="character-img">`;
                } else {
                    // 如果是普通文本汉字，处理儿化音和图像标记
                    characterDisplay = processTextWithImages(item.character, true);
                }
                
                let html = `
                    <div class="character-header">
                        <div class="character-title">${characterDisplay}</div>
                    </div>
                `;
                
                // 添加每个拼音的信息
                item.pinyins.forEach(pinyinObj => {
                    // 处理拼音显示，处理儿化音和图像标记
                    const pinyinDisplay = processTextWithImages(pinyinObj.pinyin, false);
                    
                    html += `
                        <div class="pinyin-container">
                            <div class="pinyin-item">
                                <div class="pinyin-text">${pinyinDisplay}</div>
                    `;
                    
                    // 添加释义
                    if (pinyinObj.meanings && pinyinObj.meanings.length > 0) {
                        html += `<div class="meaning-container">`;
                        
                        // 显示所有释义
                        pinyinObj.meanings.forEach((meaning, index) => {
                            const meaningDisplay = processTextWithImages(meaning, false);
                            html += `<div class="meaning-item">${meaningDisplay}</div>`;
                            
                            // 检查是否有针对当前释义的例句
                            if (pinyinObj.examples && pinyinObj.examples.length > 0) {
                                // 这里简单假设第一个例句对应第一个释义，以此类推
                                if (pinyinObj.examples[index]) {
                                    const example = pinyinObj.examples[index];
                                    const dialectDisplay = processTextWithImages(example.dialect, false);
                                    const translationDisplay = processTextWithImages(example.translation, false);
                                    
                                    html += `<div class="example-container">`;
                                    html += `<div class="example-dialect">${dialectDisplay}</div>`;
                                    if (example.translation) {
                                        html += `<div class="example-translation">${translationDisplay}</div>`;
                                    }
                                    html += `</div>`;
                                }
                            }
                        });
                        
                        html += `</div>`;
                    }
                    
                    // 添加普通例句（不是针对特定释义的）
                    if (pinyinObj.examples && pinyinObj.examples.length > 0) {
                        // 检查是否有未关联到释义的例句
                        const totalMeanings = pinyinObj.meanings ? pinyinObj.meanings.length : 0;
                        if (pinyinObj.examples.length > totalMeanings) {
                            html += `<div class="example-container">`;
                            for (let i = totalMeanings; i < pinyinObj.examples.length; i++) {
                                const example = pinyinObj.examples[i];
                                const dialectDisplay = processTextWithImages(example.dialect, false);
                                const translationDisplay = processTextWithImages(example.translation, false);
                                
                                html += `<div class="example-dialect">${dialectDisplay}</div>`;
                                if (example.translation) {
                                    html += `<div class="example-translation">${translationDisplay}</div>`;
                                }
                            }
                            html += `</div>`;
                        }
                    }
                    
                    // 添加词条
                    if (pinyinObj.entries && pinyinObj.entries.length > 0) {
                        html += `<div class="entry-container">`;
                        pinyinObj.entries.forEach(entry => {
                            const entryTitle = processTextWithImages(entry.title, false);
                            const entryPinyin = processTextWithImages(entry.entryPinyin, false);
                            const entryDefinition = processTextWithImages(entry.definition, false);
                            
                            html += `
                                <div class="entry-item">
                                    <div class="entry-title">【${entryTitle}】</div>
                                    ${entryPinyin ? `<div class="entry-pinyin">${entryPinyin}</div>` : ''}
                                    ${entryDefinition ? `<div class="entry-definition">${entryDefinition}</div>` : ''}
                            `;
                            
                            // 添加词条例句
                            if (entry.examples && entry.examples.length > 0) {
                                entry.examples.forEach(example => {
                                    const exampleDialect = processTextWithImages(example.dialect, false);
                                    const exampleTranslation = processTextWithImages(example.translation, false);
                                    
                                    html += `<div class="example-container">`;
                                    html += `<div class="example-dialect">${exampleDialect}</div>`;
                                    if (example.translation) {
                                        html += `<div class="example-translation">${exampleTranslation}</div>`;
                                    }
                                    html += `</div>`;
                                });
                            }
                            
                            html += `</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    // 添加注意事项
                    if (pinyinObj.notes) {
                        const notesDisplay = processTextWithImages(pinyinObj.notes, false);
                        html += `
                            <div class="note-container">
                                <div class="note-title">注意</div>
                                <div class="note-content">${notesDisplay}</div>
                            </div>
                        `;
                    }
                    
                    html += `</div></div>`;
                });
                
                resultElement.innerHTML = html;
                resultsContainer.appendChild(resultElement);
            });
            
            // 添加显示全部条目的提示
            const totalCount = document.createElement('div');
            totalCount.className = 'no-results';
            totalCount.innerHTML = `
                <i class="fas fa-database"></i>
                <h3>显示全部内容</h3>
                <p>当前数据库中共有 ${dialectDatabase.length} 个条目</p>
                <p style="margin-top: 15px; font-size: 0.9rem; color: #777;">
                    搜索"Every"即可显示本页面。
                </p>
            `;
            resultsContainer.appendChild(totalCount);
        }
        
        // 显示搜索结果
        function displayResults(results, query) {
            results.forEach(item => {
                const resultElement = document.createElement('div');
                resultElement.className = 'character-item';
                
                // 创建汉字标题（高亮显示）
                let highlightedCharacter;
                if (typeof item.character === 'object' && item.character.type === 'img') {
                    // 如果是图片类型的汉字
                    highlightedCharacter = `<img src="images/${item.character.src}.png" alt="生僻字" class="character-img">`;
                } else {
                    // 如果是普通文本汉字，使用高亮函数（已包含图像和儿化音处理）
                    highlightedCharacter = highlightText(item.character, query, true);
                }
                
                let html = `
                    <div class="character-header">
                        <div class="character-title">${highlightedCharacter}</div>
                    </div>
                `;
                
                // 添加每个拼音的信息
                item.pinyins.forEach(pinyinObj => {
                    // 处理拼音显示（已包含图像、儿化音处理和高亮）
                    const pinyinDisplay = highlightText(pinyinObj.pinyin, query, false);
                    
                    html += `
                        <div class="pinyin-container">
                            <div class="pinyin-item">
                                <div class="pinyin-text">${pinyinDisplay}</div>
                    `;
                    
                    // 添加释义
                    if (pinyinObj.meanings && pinyinObj.meanings.length > 0) {
                        html += `<div class="meaning-container">`;
                        
                        // 显示所有释义
                        pinyinObj.meanings.forEach((meaning, index) => {
                            const meaningDisplay = highlightText(meaning, query, false);
                            html += `<div class="meaning-item">${meaningDisplay}</div>`;
                            
                            // 检查是否有针对当前释义的例句
                            if (pinyinObj.examples && pinyinObj.examples.length > 0) {
                                // 这里简单假设第一个例句对应第一个释义，以此类推
                                if (pinyinObj.examples[index]) {
                                    const example = pinyinObj.examples[index];
                                    const dialectDisplay = highlightText(example.dialect, query, false);
                                    const highlightedTranslation = highlightText(example.translation, query, false);
                                    
                                    html += `<div class="example-container">`;
                                    html += `<div class="example-dialect">${dialectDisplay}</div>`;
                                    if (example.translation) {
                                        html += `<div class="example-translation">${highlightedTranslation}</div>`;
                                    }
                                    html += `</div>`;
                                }
                            }
                        });
                        
                        html += `</div>`;
                    }
                    
                    // 添加普通例句（不是针对特定释义的）
                    if (pinyinObj.examples && pinyinObj.examples.length > 0) {
                        // 检查是否有未关联到释义的例句
                        const totalMeanings = pinyinObj.meanings ? pinyinObj.meanings.length : 0;
                        if (pinyinObj.examples.length > totalMeanings) {
                            html += `<div class="example-container">`;
                            for (let i = totalMeanings; i < pinyinObj.examples.length; i++) {
                                const example = pinyinObj.examples[i];
                                const dialectDisplay = highlightText(example.dialect, query, false);
                                const highlightedTranslation = highlightText(example.translation, query, false);
                                
                                html += `<div class="example-dialect">${dialectDisplay}</div>`;
                                if (example.translation) {
                                    html += `<div class="example-translation">${highlightedTranslation}</div>`;
                                }
                            }
                            html += `</div>`;
                        }
                    }
                    
                    // 添加词条
                    if (pinyinObj.entries && pinyinObj.entries.length > 0) {
                        html += `<div class="entry-container">`;
                        pinyinObj.entries.forEach(entry => {
                            const entryTitle = highlightText(entry.title, query, false);
                            const entryPinyin = highlightText(entry.entryPinyin, query, false);
                            const entryDefinition = highlightText(entry.definition, query, false);
                            
                            html += `
                                <div class="entry-item">
                                    <div class="entry-title">【${entryTitle}】</div>
                                    ${entryPinyin ? `<div class="entry-pinyin">${entryPinyin}</div>` : ''}
                                    ${entryDefinition ? `<div class="entry-definition">${entryDefinition}</div>` : ''}
                            `;
                            
                            // 添加词条例句
                            if (entry.examples && entry.examples.length > 0) {
                                entry.examples.forEach(example => {
                                    const exampleDialect = highlightText(example.dialect, query, false);
                                    const exampleTranslation = highlightText(example.translation, query, false);
                                    
                                    html += `<div class="example-container">`;
                                    html += `<div class="example-dialect">${exampleDialect}</div>`;
                                    if (example.translation) {
                                        html += `<div class="example-translation">${exampleTranslation}</div>`;
                                    }
                                    html += `</div>`;
                                });
                            }
                            
                            html += `</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    // 添加注意事项
                    if (pinyinObj.notes) {
                        const notesDisplay = highlightText(pinyinObj.notes, query, false);
                        html += `
                            <div class="note-container">
                                <div class="note-title">注意</div>
                                <div class="note-content">${notesDisplay}</div>
                            </div>
                        `;
                    }
                    
                    html += `</div></div>`;
                });
                
                resultElement.innerHTML = html;
                resultsContainer.appendChild(resultElement);
            });
        }
        
        // 页面切换函数
        function switchPage(pageId) {
            // 首先恢复所有页面元素的显示
            document.querySelector('header').style.display = 'block';
            document.querySelector('nav').style.display = 'block';
            document.querySelector('footer').style.display = 'block';
            
            // 隐藏所有页面
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('grammar-page').style.display = 'none';
            document.getElementById('about-page').style.display = 'none';
            document.getElementById('page404').style.display = 'none';
            
            // 恢复页面滚动
            document.body.style.overflow = 'auto';
            
            // 显示目标页面
            if (pageId === 'home') {
                document.getElementById('home-page').style.display = 'block';
            } else if (pageId === 'grammar') {
                document.getElementById('grammar-page').style.display = 'block';
            } else if (pageId === 'about') {
                document.getElementById('about-page').style.display = 'block';
            }
            
            // 更新导航激活状态
            Object.keys(navLinks).forEach(key => {
                if (navLinks[key]) {
                    if (key === pageId) {
                        navLinks[key].classList.add('active');
                    } else {
                        navLinks[key].classList.remove('active');
                    }
                }
            });
            
            // 如果是首页，滚动到搜索区域
            if (pageId === 'home') {
                window.scrollTo({top: 0, behavior: 'smooth'});
            }
        }

        // 弹窗显示/隐藏函数
        function showModal() {
            grammarModal.classList.add('show');
            // 禁止背景滚动
            document.body.style.overflow = 'hidden';
        }
        function hideModal() {
            grammarModal.classList.remove('show');
            // 恢复背景滚动
            document.body.style.overflow = 'auto';
        }

        // 事件监听
        searchBtn.addEventListener('click', () => {
            const query = searchInput.value.trim();
            searchDialect(query, currentSearchMode);
        });
        
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = searchInput.value.trim();
                searchDialect(query, currentSearchMode);
            }
        });
        
        // 搜索模式切换
        searchModeSelect.addEventListener('change', function() {
            currentSearchMode = this.value;
            
            // 更新模式描述
            if (currentSearchMode === 'default') {
                modeDescription.textContent = '默认模式：仅支持按定州方言查询。反查模式：支持按定州方言查询和通过释义反查。';
            } else {
                modeDescription.textContent = '反查模式：支持按定州方言查询和通过释义反查。默认模式：仅支持按定州方言查询。';
            }
            
            // 如果搜索框有内容，重新搜索
            if (searchInput.value.trim() && !searchInput.value.includes('腚')) {
                searchDialect(searchInput.value.trim(), currentSearchMode);
            } else {
                showInitialMessage();
            }
        });
        
        // 示例词点击事件
        exampleWords.forEach(wordElement => {
            wordElement.addEventListener('click', () => {
                const word = wordElement.getAttribute('data-word');
                searchInput.value = word;
                searchDialect(word, currentSearchMode);
            });
        });
        
        // 导航点击事件 - 排除闯关链接（它已经在新标签页打开）
        Object.keys(navLinks).forEach(key => {
            if (navLinks[key] && key !== 'challenge') {
                navLinks[key].addEventListener('click', (e) => {
                    e.preventDefault();
                    // 语法导航单独处理，显示弹窗
                    if (key === 'grammar') {
                        showModal();
                    } else {
                        switchPage(key);
                    }
                });
            }
        });

        // 弹窗按钮事件
        // 确认按钮 - 跳转PDF链接
        modalConfirm.addEventListener('click', () => {
            hideModal();
            window.open(PDF_LINK, '_blank'); // 新标签页打开PDF
        });
        // 取消按钮 - 隐藏弹窗并返回首页
        modalCancel.addEventListener('click', () => {
            hideModal();
            switchPage('home');
            navLinks.home.classList.add('active');
            navLinks.grammar.classList.remove('active');
        });
        // 点击弹窗遮罩层关闭弹窗
        grammarModal.addEventListener('click', (e) => {
            if (e.target === grammarModal) {
                hideModal();
            }
        });
        
        // 输入提示弹窗确认按钮
        inputAlertConfirm.addEventListener('click', hideInputAlert);
        // 点击输入提示弹窗遮罩层关闭弹窗
        inputAlertModal.addEventListener('click', (e) => {
            if (e.target === inputAlertModal) {
                hideInputAlert();
            }
        });
        
        // ESC键关闭弹窗
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (grammarModal.classList.contains('show')) {
                    hideModal();
                }
                if (inputAlertModal.classList.contains('show')) {
                    hideInputAlert();
                }
            }
        });
        
        // 初始化页面
        function initPage() {
            // 初始显示首页
            switchPage('home');
            
            // 清空搜索框
            searchInput.value = '';
            
            // 显示初始消息
            showInitialMessage();
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initPage);
        
        // 添加一些交互效果
        searchInput.addEventListener('focus', function() {
            this.parentElement.style.transform = 'translateY(-5px)';
        });
        
        searchInput.addEventListener('blur', function() {
            this.parentElement.style.transform = 'translateY(0)';
        });
        
        // 添加搜索建议提示
        searchInput.addEventListener('input', function() {
            const query = this.value.trim();
            if (query.toLowerCase() === 'ng') {
                // 显示提示：可以匹配ŋ
                const searchBox = document.querySelector('.search-box');
                let hint = document.querySelector('.ng-hint');
                
                if (!hint) {
                    hint = document.createElement('div');
                    hint.className = 'ng-hint';
                    hint.style.cssText = `
                        margin-top: 8px;
                        font-size: 0.9rem;
                        color: rgba(255, 255, 255, 0.8);
                        font-style: italic;
                    `;
                    searchBox.appendChild(hint);
                }
                
                hint.textContent = '提示：搜索ng可以查询到ŋ音';
            } else {
                // 移除提示
                const hint = document.querySelector('.ng-hint');
                if (hint) {
                    hint.remove();
                }
            }
        });
    </script>
</body>
</html>
